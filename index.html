<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Timelux Web App</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #fff; color: #111; }
    header { padding: 1rem; font-size: 1.2rem; font-weight: bold; border-bottom: 1px solid #eee; }
    .product { border-bottom: 1px solid #eee; padding: 1rem; }
    .product img { max-width: 100%; }
    .title { font-size: 1rem; font-weight: bold; margin: 0.5rem 0; }
    .article { font-size: 0.8rem; color: #888; }
    .price { font-size: 1rem; margin: 0.5rem 0; }
    .actions { display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem; }
    .btn { padding: 0.5rem 1rem; border: none; border-radius: 99px; background: #000; color: #fff; font-weight: 500; cursor: pointer; }
    .btn.gray { background: #f5f5f5; color: #000; border: 1px solid #ccc; }
    .btn:disabled { background: #aaa; cursor: not-allowed; }
    .nav { display: flex; justify-content: space-around; padding: 0.5rem 0; border-top: 1px solid #eee; background: #fff; position: fixed; width: 100%; bottom: 0; }
    .nav div { text-align: center; font-size: 0.75rem; color: #000; }
    .cart-indicator { position: absolute; background: red; color: white; font-size: 0.7rem; padding: 2px 5px; border-radius: 999px; top: -5px; right: -10px; }
  </style>
</head>
<body>
  <header>Каталог товаров</header>
  <div id="catalog">Загрузка...</div>

  <script>
    const catalogEl = document.getElementById("catalog");
    const cart = {};

    fetch("products.json")
      .then(res => res.json())
      .then(data => {
        catalogEl.innerHTML = "";
        data.forEach(item => {
          const div = document.createElement("div");
          div.className = "product";
          div.innerHTML = `
            <div class="title">${item.title}</div>
            <div class="article">Артикул: ${item.id || 'N/A'}</div>
            <div class="price">Цена: ${item.price} ₽</div>
            <div class="actions" id="action-${item.id}">
              <button class="btn" onclick="addToCart(${item.id}, '${item.title}', ${item.price})">Добавить в корзину</button>
            </div>
          `;
          catalogEl.appendChild(div);
        });
      });

    function addToCart(id, name, price) {
      if (!cart[id]) cart[id] = { name, price, quantity: 0 };
      cart[id].quantity += 1;
      updateProductUI(id);
    }

    function changeQuantity(id, delta) {
      if (!cart[id]) return;
      cart[id].quantity += delta;
      if (cart[id].quantity <= 0) delete cart[id];
      updateProductUI(id);
    }

    function updateProductUI(id) {
      const actionEl = document.getElementById(`action-${id}`);
      if (!cart[id]) {
        actionEl.innerHTML = `<button class="btn" onclick="addToCart(${id}, 'undefined', 0)">Добавить в корзину</button>`;
        return;
      }
      const qty = cart[id].quantity;
      actionEl.innerHTML = `
        <button class="btn gray" onclick="changeQuantity(${id}, -1)">−</button>
        <span>${qty}</span>
        <button class="btn gray" onclick="changeQuantity(${id}, 1)">+</button>
        <button class="btn" onclick="goToCart()">Перейти</button>
      `;
      updateCartIcon();
    }

    function goToCart() {
      alert("Переход в корзину (реализуется во вкладке 'Корзина')");
    }

    function updateCartIcon() {
      const total = Object.values(cart).reduce((sum, i) => sum + i.quantity, 0);
      const badge = document.getElementById("cart-badge");
      if (badge) badge.textContent = total > 0 ? total : "";
    }
  </script>

  <div class="nav">
    <div>Каталог</div>
    <div>Избранное</div>
    <div style="position:relative">
      Корзина
      <span id="cart-badge" class="cart-indicator"></span>
    </div>
    <div>Чат</div>
    <div>Профиль</div>
  </div>
</body>
</html>
