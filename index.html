<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TimeLux CO</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      background: #fff;
      color: #000;
    }

    .product {
      padding: 16px;
      border-bottom: 1px solid #ddd;
    }

    .product h3 {
      margin: 0 0 8px;
    }

    .actions {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 8px;
    }

    button {
      border: none;
      background: #000;
      color: #fff;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-light {
      background: #eee;
      color: #000;
    }

    .btn-qty {
      width: 32px;
      height: 32px;
      font-size: 18px;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      display: flex;
      justify-content: space-around;
      border-top: 1px solid #ccc;
      background: #fff;
      padding: 8px 0;
    }

    .bottom-nav .icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
      color: #000;
    }

    .bottom-nav .icon svg {
      width: 24px;
      height: 24px;
    }

    .cart-badge {
      background: red;
      color: white;
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 999px;
      position: absolute;
      top: 2px;
      right: 10px;
    }

    .tab {
      display: none;
      padding-bottom: 60px;
    }

    .tab.active {
      display: block;
    }

    .cart-list {
      padding: 16px;
    }

    .cart-item {
      margin-bottom: 8px;
    }
  </style>
</head>
<body>

  <div id="catalogTab" class="tab active">
    <div id="catalog">Загрузка...</div>
  </div>

  <div id="cartTab" class="tab">
    <div class="cart-list" id="cartList">Корзина пуста</div>
  </div>

  <div id="favoritesTab" class="tab">
    <p style="padding: 16px;">Избранное скоро появится.</p>
  </div>

  <div id="chatTab" class="tab">
    <p style="padding: 16px;">Чат поддержки в разработке.</p>
  </div>

  <div id="profileTab" class="tab">
    <p style="padding: 16px;">Профиль: информация о заказах, возвратах и избранном появится здесь.</p>
  </div>

  <div class="bottom-nav">
    <div class="icon" onclick="switchTab('catalogTab')">
      <svg><use href="#icon-home" /></svg>
      Каталог
    </div>
    <div class="icon" onclick="switchTab('favoritesTab')">
      <svg><use href="#icon-heart" /></svg>
      Избранное
    </div>
    <div class="icon" onclick="switchTab('cartTab')" style="position: relative;">
      <svg><use href="#icon-cart" /></svg>
      <div id="cartCount" class="cart-badge" style="display: none;">0</div>
      Корзина
    </div>
    <div class="icon" onclick="switchTab('chatTab')">
      <svg><use href="#icon-message" /></svg>
      Чат
    </div>
    <div class="icon" onclick="switchTab('profileTab')">
      <svg><use href="#icon-user" /></svg>
      Профиль
    </div>
  </div>

  <svg style="display:none">
    <symbol id="icon-home" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v12a1 1 0 0 1-1 1h-5v-7h-6v7H4a1 1 0 0 1-1-1z"/></symbol>
    <symbol id="icon-heart" viewBox="0 0 24 24"><path d="M12 21c-4.8-4.3-8-7.2-8-11.2C4 6 6 4 8.5 4c1.7 0 3.3 1 4.5 2.5C14.2 5 15.8 4 17.5 4 20 4 22 6 22 9.8c0 4-3.2 6.9-8 11.2z"/></symbol>
    <symbol id="icon-cart" viewBox="0 0 24 24"><path d="M7 4h-2l-3 9v1h2l3.6 7.6a1 1 0 0 0 1.4.4h9.4a1 1 0 0 0 1-.7l3-8H6.1"/></symbol>
    <symbol id="icon-message" viewBox="0 0 24 24"><path d="M4 4h16v12H5.17L4 18V4z"/></symbol>
    <symbol id="icon-user" viewBox="0 0 24 24"><path d="M12 2a5 5 0 1 1 0 10 5 5 0 0 1 0-10zm0 12c4 0 7 3 7 7H5c0-4 3-7 7-7z"/></symbol>
  </svg>

  <script>
    const catalogEl = document.getElementById("catalog");
    const cartList = document.getElementById("cartList");
    const cartCountEl = document.getElementById("cartCount");
    const cart = [];

    function switchTab(tabId) {
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      document.getElementById(tabId).classList.add("active");
    }

    fetch("products.json")
      .then(res => res.json())
      .then(data => {
        catalogEl.innerHTML = "";
        data.forEach(item => {
          const div = document.createElement("div");
          div.className = "product";
          div.innerHTML = `
            <h3>${item.title}</h3>
            <p>Артикул: ${item.sku || 'N/A'}</p>
            <p>Цена: ${item.price} ₽</p>
            <div class="actions" id="actions-${item.id}">
              <button onclick="addToCart(${item.id}, '${item.title}', ${item.price})">Добавить в корзину</button>
            </div>
          `;
          catalogEl.appendChild(div);
        });
      });

    function addToCart(id, name, price) {
      const index = cart.findIndex(i => i.id === id);
      if (index === -1) {
        cart.push({ id, name, price, qty: 1 });
      } else {
        cart[index].qty += 1;
      }
      updateCart();
      updateControls(id, name, price);
    }

    function updateControls(id, name, price) {
      const div = document.getElementById(`actions-${id}`);
      const item = cart.find(i => i.id === id);
      div.innerHTML = `
        <button class="btn-qty btn-light" onclick="changeQty(${id}, -1)">−</button>
        <span>${item.qty}</span>
        <button class="btn-qty btn-light" onclick="changeQty(${id}, 1)">+</button>
        <button onclick="switchTab('cartTab')">Перейти</button>
      `;
    }

    function changeQty(id, delta) {
      const item = cart.find(i => i.id === id);
      if (!item) return;
      item.qty += delta;
      if (item.qty <= 0) {
        const i = cart.findIndex(i => i.id === id);
        cart.splice(i, 1);
        document.getElementById(`actions-${id}`).innerHTML =
          `<button onclick="addToCart(${id}, '${item.name}', ${item.price})">Добавить в корзину</button>`;
      } else {
        updateControls(id, item.name, item.price);
      }
      updateCart();
    }

    function updateCart() {
      const totalItems = cart.reduce((sum, i) => sum + i.qty, 0);
      const totalPrice = cart.reduce((sum, i) => sum + i.qty * i.price, 0);
      cartList.innerHTML = cart.length === 0
        ? "Корзина пуста"
        : cart.map(i => `<div class="cart-item">${i.name} — ${i.price} ₽ × ${i.qty}</div>`).join("") +
          `<p><strong>Итого: ${totalPrice} ₽</strong></p>`;
      cartCountEl.style.display = totalItems > 0 ? "block" : "none";
      cartCountEl.textContent = totalItems;
    }

    Telegram.WebApp.ready();
  </script>

</body>
</html>
