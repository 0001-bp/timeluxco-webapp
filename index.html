<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Timelux Web App</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #fff; }
    header, footer { background: #fff; border-top: 1px solid #ddd; display: flex; justify-content: space-around; align-items: center; padding: 0.5rem 0; position: fixed; width: 100%; bottom: 0; }
    header { top: 0; bottom: auto; }
    main { padding: 1rem; padding-bottom: 60px; padding-top: 40px; }
    .product { border-bottom: 1px solid #eee; padding: 1rem 0; }
    .product img { width: 100px; }
    .btn { background: #000; color: white; border: none; padding: 0.5rem 1rem; font-size: 14px; border-radius: 30px; cursor: pointer; font-weight: bold; }
    .cart-badge { background: red; color: white; border-radius: 50%; padding: 0.2rem 0.5rem; font-size: 12px; position: absolute; top: -6px; right: -6px; }
    .nav-icon { position: relative; text-align: center; font-size: 12px; }
    .nav-icon svg { width: 24px; height: 24px; display: block; margin: auto; }
    #cartPage { display: none; }
    #cartList li { margin-bottom: 5px; }
  </style>
</head>
<body>
  <header>
    <strong>TimeLux CO</strong>
  </header>
  <main>
    <section id="catalogPage">
      <h2>Каталог товаров</h2>
      <div id="catalog">Загрузка...</div>
    </section>
    <section id="cartPage">
      <h2>Корзина</h2>
      <ul id="cartList"></ul>
      <p id="cartTotal"></p>
      <button class="btn" onclick="sendOrder()">Оформить заказ</button>
    </section>
  </main>

  <footer>
    <div class="nav-icon" onclick="navigate('catalogPage')">
      <svg fill="black" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
      <div>Каталог</div>
    </div>
    <div class="nav-icon">
      <svg fill="black" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c2.04 0 3.81 1.23 4.5 3.09C12.69 4.23 14.46 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
      <div>Избранное</div>
    </div>
    <div class="nav-icon" onclick="navigate('cartPage')">
      <svg fill="black" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10-2V6H7v10h10zm0-12c1.1 0 2 .9 2 2H5c0-1.1.9-2 2-2h10z"/></svg>
      <span id="cartCount" class="cart-badge" style="display:none">0</span>
      <div>Корзина</div>
    </div>
    <div class="nav-icon">
      <svg fill="black" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
      <div>Профиль</div>
    </div>
  </footer>

  <script>
    const catalogEl = document.getElementById("catalog");
    const cartList = document.getElementById("cartList");
    const cartTotal = document.getElementById("cartTotal");
    const cartBadge = document.getElementById("cartCount");
    const cart = {};

    function navigate(page) {
      document.getElementById("catalogPage").style.display = page === 'catalogPage' ? 'block' : 'none';
      document.getElementById("cartPage").style.display = page === 'cartPage' ? 'block' : 'none';
    }

    fetch("products.json")
      .then(res => res.json())
      .then(data => {
        catalogEl.innerHTML = "";
        data.forEach(item => {
          const div = document.createElement("div");
          div.className = "product";
          div.innerHTML = `
            <h3>${item.title}</h3>
            <p style="color: #777; font-size: 12px;">Артикул: ${item.sku || 'N/A'}</p>
            <p>Цена: ${item.price} ₽</p>
            <button class="btn" onclick='addToCart(${JSON.stringify(item)})'>Добавить</button>
          `;
          catalogEl.appendChild(div);
        });
      });

    function addToCart(item) {
      if (cart[item.title]) {
        cart[item.title].qty++;
      } else {
        cart[item.title] = { ...item, qty: 1 };
      }
      updateCartUI();
    }

    function updateCartUI() {
      cartList.innerHTML = "";
      let total = 0;
      let count = 0;
      for (const key in cart) {
        const { price, qty } = cart[key];
        const li = document.createElement("li");
        li.textContent = `${key} — ${price} ₽ × ${qty}`;
        cartList.appendChild(li);
        total += price * qty;
        count += qty;
      }
      cartTotal.textContent = `Итого: ${total} ₽`;
      if (count > 0) {
        cartBadge.textContent = count;
        cartBadge.style.display = 'inline';
      } else {
        cartBadge.style.display = 'none';
      }
    }

    function sendOrder() {
      const order = Object.values(cart).map(i => `${i.title} — ${i.price} ₽ × ${i.qty}`).join("\n");
      const total = Object.values(cart).reduce((sum, i) => sum + i.price * i.qty, 0);
      const message = `Ваш заказ:\n${order}\nИтого: ${total} ₽`;
      Telegram.WebApp.sendData(message);
      Telegram.WebApp.close();
    }

    Telegram.WebApp.ready();
  </script>
</body>
</html>
