<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TimeLux CO</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding-bottom: 80px;
    }
    .product {
      padding: 1rem;
      border-bottom: 1px solid #eee;
    }
    .product img {
      max-width: 100%;
      border-radius: 10px;
    }
    .price {
      font-weight: bold;
    }
    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .btn-black {
      background: black;
      color: white;
    }
    .btn-outline {
      border: 1px solid #ccc;
      background: transparent;
      color: black;
      min-width: 35px;
      height: 35px;
    }
    .quantity-control {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    .footer-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #fff;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: space-around;
      padding: 0.5rem 0;
    }
    .footer-nav div {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
      color: #333;
    }
    .footer-nav .material-icons {
      font-size: 24px;
    }
    .active {
      color: black;
    }
    .badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: red;
      color: white;
      font-size: 10px;
      padding: 2px 5px;
      border-radius: 50%;
    }
    #catalog,
    #cart,
    #favorites,
    #chat,
    #profile {
      display: none;
      padding: 1rem;
    }
    .visible {
      display: block;
    }
  </style>
</head>
<body>
  <div id="catalog" class="visible">
    <h2>Каталог</h2>
    <div id="productList">Загрузка...</div>
  </div>

  <div id="cart">
    <h2>Корзина</h2>
    <ul id="cartList"></ul>
    <p id="total"></p>
  </div>

  <div id="favorites"><h2>Избранное</h2></div>
  <div id="chat"><h2>Чат</h2></div>
  <div id="profile"><h2>Профиль</h2></div>

  <div class="footer-nav">
    <div onclick="switchTab('catalog')">
      <span class="material-icons">home</span>
      Каталог
    </div>
    <div onclick="switchTab('favorites')">
      <span class="material-icons">favorite_border</span>
      Избранное
    </div>
    <div style="position: relative;" onclick="switchTab('cart')">
      <span class="material-icons">shopping_cart</span>
      <span id="cartBadge" class="badge" style="display:none;">0</span>
      Корзина
    </div>
    <div onclick="switchTab('chat')">
      <span class="material-icons">chat_bubble_outline</span>
      Чат
    </div>
    <div onclick="switchTab('profile')">
      <span class="material-icons">person_outline</span>
      Профиль
    </div>
  </div>

  <script>
    const productList = document.getElementById('productList');
    const cartList = document.getElementById('cartList');
    const totalEl = document.getElementById('total');
    const cartBadge = document.getElementById('cartBadge');
    const cart = {};

    function switchTab(tabId) {
      document.querySelectorAll('body > div:not(.footer-nav)').forEach(el => el.classList.remove('visible'));
      document.getElementById(tabId).classList.add('visible');
    }

    fetch('products.json')
      .then(res => res.json())
      .then(data => {
        productList.innerHTML = '';
        data.forEach(product => {
          const div = document.createElement('div');
          div.className = 'product';
          div.innerHTML = `
            <h3>${product.title}</h3>
            <img src="${product.image}" alt="${product.title}">
            <p>Артикул: ${product.sku || 'N/A'}</p>
            <p class="price">Цена: ${product.price} ₽</p>
            <div id="controls-${product.id}">
              <button class="btn btn-black" onclick="addToCart(${product.id}, '${product.title}', ${product.price})">Добавить в корзину</button>
            </div>
          `;
          productList.appendChild(div);
        });
      });

    function addToCart(id, name, price) {
      if (!cart[id]) {
        cart[id] = { name, price, quantity: 1 };
      } else {
        cart[id].quantity++;
      }
      updateCartUI();
      showProductControls(id);
    }

    function updateCartUI() {
      cartList.innerHTML = '';
      let total = 0;
      let count = 0;
      for (let key in cart) {
        const item = cart[key];
        total += item.price * item.quantity;
        count += item.quantity;
        const li = document.createElement('li');
        li.textContent = `${item.name} — ${item.price} ₽ × ${item.quantity}`;
        cartList.appendChild(li);
      }
      totalEl.textContent = 'Итого: ' + total + ' ₽';
      cartBadge.style.display = count > 0 ? 'block' : 'none';
      cartBadge.textContent = count;
    }

    function showProductControls(id) {
      const container = document.getElementById('controls-' + id);
      const item = cart[id];
      container.innerHTML = `
        <div class="quantity-control">
          <button class="btn-outline" onclick="changeQty(${id}, -1)">−</button>
          <span>${item.quantity}</span>
          <button class="btn-outline" onclick="changeQty(${id}, 1)">+</button>
          <button class="btn btn-black" onclick="switchTab('cart')">Перейти</button>
        </div>
      `;
    }

    function changeQty(id, delta) {
      if (cart[id]) {
        cart[id].quantity += delta;
        if (cart[id].quantity <= 0) {
          delete cart[id];
          document.getElementById('controls-' + id).innerHTML = `
            <button class="btn btn-black" onclick="addToCart(${id}, '${cart[id]?.name || 'Товар'}', ${cart[id]?.price || 0})">Добавить в корзину</button>
          `;
        } else {
          showProductControls(id);
        }
        updateCartUI();
      }
    }

    Telegram.WebApp.ready();
  </script>
</body>
</html>
